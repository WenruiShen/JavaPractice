package test002_sql;
import java.sql.*;

public class test_sql {
	public static void main(String[] args) {
		MySQL_Poker_test Poker_sql = new MySQL_Poker_test(); 
		Poker_sql.MySQL_Poker_test();
	}
}

class MySQL_Poker_test{
	
	String database = "ucd_test_20170126";
	String table_poker_cards = "poker_cards";
	
	String driver = "com.mysql.jdbc.Driver";
	String url = "jdbc:mysql://localhost:3306/" + database + "?useSSL=false";
	String user = "root";
	String password = "SWRMYSQL";
	
	public void MySQL_Poker_test(){
		System.out.println("MySQL_Poker_test Begin!");
		
		try{
			// Load driver
			Class.forName(driver);
			
			// Connect SQL Database
			Connection conn = DriverManager.getConnection(url, user, password);
			if(!conn.isClosed())
				System.out.println("Successed connecting to the database: " + database);

			// Statements allow to issue SQL queries to the database
			Statement statement = conn.createStatement();
			PreparedStatement preparedStatement = null;
			
			
			// Result set get the result of the SQL query
			String sql = "select * from " + database + '.' + table_poker_cards;
			ResultSet rs = statement.executeQuery(sql);
			// Display Query results
			writeResultSet(rs);
			
			// Create 52 poker cards in the table
			poker_create(statement, preparedStatement, conn);
			
			rs = statement.executeQuery(sql);
			writeResultSet(rs);
			
			rs.close();
			conn.close();	
			
		} catch(ClassNotFoundException e){
			System.out.println("Sorry,can`t find the Driver!");
			e.printStackTrace();
		} catch(SQLException e) {
			e.printStackTrace();
		} catch(Exception e) {	
			e.printStackTrace();
		}
		
	}
	
	private void writeResultSet(ResultSet rs) throws SQLException {
		// Display Query results
		String format_column = "%-10s %-10s %-10s %-10s %-10s %-10s \n";
		String format_row = "%-10s %-10d %-10s %-10s %-10d %-10d \n";
		System.out.format(format_column, "CardName", "Face", "Type", "Suit", "FaceValue", "GameValue");
		while(rs.next()){
			String CardName = rs.getString("CardName");
			int Face = rs.getInt("Face");
			String Type = rs.getString("Type");
			String Suit = rs.getString("Suit");
			int FaceValue = rs.getInt("FaceValue");
			int GameValue = rs.getInt("GameValue");
			System.out.format(format_row, CardName, Face, Type, Suit, FaceValue, GameValue);
			
		}
	}
	
	private void poker_create(Statement statement, PreparedStatement preparedStatement, Connection conn)
			throws SQLException {
		int cards_sum = 52;
		
		int cards_types_sum = 13;
		String cards_type_list[] = {"A","2","3","4","5","6","7","8","9","10","J","P","K"};
		
		int cards_suits_sum = 4;
		String cards_suit_list[] = {"H","S","D","C",};
		
		System.out.println("Now Creating a Poker!");
		for(int cards_suits_no = 0; cards_suits_no < cards_suit_list.length; cards_suits_no++){
			
			for(int cards_types_no = 0; cards_types_no < cards_type_list.length; cards_types_no++){
				
				String card_name = cards_type_list[cards_types_no] + cards_suit_list[cards_suits_no];
				int card_face = cards_types_no > 9 ? 1 : 0;
				String card_type = cards_type_list[cards_types_no];
				String card_suit = cards_suit_list[cards_suits_no];
				int face_value = cards_types_no + 1;
				int game_value = cards_types_no == 0 ? 14 : cards_types_no + 1;
				
				// check existing rows, avoiding duplicate
				String sql = "select * from " + database + '.' + table_poker_cards + " where CardName=\"" + card_name + "\"";
				ResultSet rs_check = statement.executeQuery(sql);				
				
				if(rs_check.next()) {
					System.out.println("deleting " + card_name);
					// delete existing record
					preparedStatement = conn.prepareStatement(
							"delete from " + database + '.' + table_poker_cards + " where CardName=\"" + card_name + "\"");
					preparedStatement.executeUpdate();
				}
				
				preparedStatement = conn.prepareStatement(
						"insert into " + database + '.' + table_poker_cards + " values (?, ?, ?, ? , ?, ?)");
				preparedStatement.setString(1, card_name);
				preparedStatement.setInt(2, card_face);
				preparedStatement.setString(3, card_type);
				preparedStatement.setString(4, card_suit);
				preparedStatement.setInt(5, face_value);
				preparedStatement.setInt(6, game_value);
				
				preparedStatement.executeUpdate();
			}
		}
		
		
	}
}

class MySQL_Poker_hands_test{
	
	String database = "ucd_test_20170126";
	String table_poker_cards = "poker_cards";
	
	String driver = "com.mysql.jdbc.Driver";
	String url = "jdbc:mysql://localhost:3306/" + database + "?useSSL=false";
	String user = "root";
	String password = "SWRMYSQL";
}
